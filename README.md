# Result Pipeline and Viewer

## Summary
This repository processes a provided Excel dataset into CSV, executes a Python script to produce a machine-readable JSON result, and publishes that result along with a small web viewer on GitHub Pages.

Key points:
- execute.py is fixed to run on Python 3.11+ with pandas 2.3.x.
- data.xlsx is converted to data.csv and committed.
- Continuous Integration runs ruff (lint), runs execute.py to generate result.json, and publishes both index.html and the generated result.json to GitHub Pages.
- result.json is not committed; it is produced only by CI.
- The included index.html is a self-contained, production-ready viewer that automatically loads ./result.json on GitHub Pages and also supports a ?url=... query parameter to load JSON from any URL.

## Setup

Prerequisites:
- Python 3.11+ installed
- GitHub repository with GitHub Actions and GitHub Pages enabled

Recommended local environment:
- Create/activate a virtual environment
- Install the required tools

Commands:
- macOS/Linux
  - python -m venv .venv
  - source .venv/bin/activate
- Windows (PowerShell)
  - python -m venv .venv
  - .\.venv\Scripts\Activate.ps1

Install dependencies:
- python -m pip install --upgrade pip
- pip install pandas==2.3.0 ruff

Note on pandas engine:
- If execute.py or any conversion step needs to read Excel locally, also install openpyxl:
  - pip install openpyxl

## Usage

Local workflow:
1) Convert Excel to CSV (one-time, commit the CSV)
- The Excel file data.xlsx is converted to data.csv, preserving the content. For a single-sheet workbook:
  - python - << "PY"
    import pandas as pd
    df = pd.read_excel("data.xlsx")  # requires openpyxl installed
    df.to_csv("data.csv", index=False)
    print("Wrote data.csv with", len(df), "rows.")
    PY
- Commit data.csv to the repository.

2) Fix and run execute.py locally
- Ensure execute.py does not contain the typo "revenew" (use "revenue") and is compatible with Python 3.11 / pandas 2.3.
- Run the script:
  - python execute.py > result.json
- Do not commit result.json. It will be generated by CI.

3) Preview the site locally (optional)
- python -m http.server 8000
- Open http://localhost:8000/index.html (it will try to load ./result.json; you can supply a custom URL via ?url=...).

Deployed (GitHub Pages) usage:
- After pushing to the main branch, GitHub Actions:
  - runs ruff (logs appear in CI),
  - runs python execute.py > result.json,
  - publishes index.html and result.json to GitHub Pages.
- View the results at https://<your-username>.github.io/<your-repo>/
  - By default the viewer loads ./result.json
  - Or pass a custom source: https://<your-username>.github.io/<your-repo>/?url=https%3A%2F%2F<your-username>.github.io%2F<your-repo>%2Fresult.json

## Code Explanation

Repository layout (key files):
- execute.py
  - Reads data.csv and produces JSON written to stdout.
  - Fixed to avoid the typo "revenew" and to be compatible with Python 3.11 and pandas 2.3.
  - Example structure:
    - import pandas as pd
    - def main():
        - df = pd.read_csv("data.csv")
        - # ... transform, aggregate, compute revenue and other fields ...
        - # print JSON to stdout (not to a file)
        - print(df.to_json(orient="records"))
    - if __name__ == "__main__":
        - main()
- data.csv
  - CSV equivalent of the provided data.xlsx (same content).
- data.xlsx
  - Original Excel attachment (kept for reference; not used in CI).
- index.html
  - A single self-contained viewer.
  - Behavior:
    - Automatically fetches ./result.json.
    - Supports ?url=... to specify a custom JSON endpoint.
    - Renders arrays of objects as a table and any JSON as pretty-printed raw.
    - Provides quick actions: Load, Download, Copy Link, Reset.
- .github/workflows/ci.yml
  - GitHub Actions workflow that lints with ruff, runs execute.py, and deploys index.html + result.json to GitHub Pages.

CI workflow (drop this file at .github/workflows/ci.yml):
```yaml
name: CI

on:
  push:
    branches:
      - main
      - master

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas==2.3.0 ruff

      - name: Ruff (lint)
        run: |
          ruff --version
          # Print lint results to log; do not fail the build hard by default
          ruff check . || true

      - name: Generate result.json
        run: |
          python execute.py > result.json
          test -s result.json

      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # Publish the repository root (includes index.html) and the generated result.json
          path: .

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

Notes:
- The ruff step runs and prints results to the CI log.
- result.json is generated at build time and included in the Pages artifact, but is never committed.
- The Pages site will include:
  - index.html (committed)
  - result.json (generated by CI)
- The workflow targets Python 3.11 with pandas 2.3.0 for compatibility.

Fix in execute.py:
- Removed any instance of the misspelling "revenew" (replaced with "revenue" and corrected logic accordingly).
- Ensured the script reads data.csv (not xlsx) so CI requires no Excel engine.
- Ensured it prints JSON to stdout and exits with a non-zero code on errors for CI visibility.

Verifications (post-push):
- Files exist: execute.py, data.csv, .github/workflows/ci.yml, index.html
- result.json is NOT committed to the repository
- CI run shows:
  - ruff check output in logs
  - python execute.py > result.json executed
  - Pages deployment completed
- Pages site serves result.json and index.html
- index.html loads ./result.json by default and also honors ?url=... to load any JSON URL with CORS enabled

## License
MIT License

Copyright (c) 2025

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.